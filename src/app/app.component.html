@if (!room()) {
<div id="join">
    <div id="join-dialog">
        <h2>Join a Room</h2>

        <form [formGroup]="roomForm" (ngSubmit)="joinRoom()">
            <div>
                <label for="participant-name">Participant</label>
                <input formControlName="participantName" id="participant-name" class="form-control" type="text" />
            </div>

            <div>
                <label for="room-name">Room</label>
                <input formControlName="roomName" id="room-name" class="form-control" type="text" />
            </div>

            <button class="btn btn-lg btn-success" type="submit" [disabled]="!roomForm.valid">Join!</button>
        </form>
    </div>
</div>
} @else {
<div id="room">
    <div id="room-header">
        <h2 id="room-title">{{ roomForm.value.roomName }}</h2>
        <div class="header-actions">
            <button class="btn btn-secondary" (click)="toggleScreenShare()" [disabled]="!room()">
                {{ isScreenSharing ? "Stop Share" : "Share Screen" }}
            </button>
            <button class="btn btn-danger" id="leave-room-button" (click)="leaveRoom()">Leave Room</button>
        </div>
    </div>

    <div id="content">
        <!-- NEW: khối 2 cột -->
        <!-- Cột trái: participants + video/screen share -->
        <div id="left-pane">
            <!-- Danh sách người trong phòng -->
            <div id="participants" class="mt-2">
                @for (p of participants(); track p) {
                <span class="badge bg-secondary me-2">{{ p }}</span>
                }
            </div>

            <!-- Lưới video/screen share -->
            <div id="layout-container">
                @for (remoteTrack of remoteTracksMap().values(); track remoteTrack.trackPublication.trackSid) { @if
                (remoteTrack.trackPublication.kind === 'audio') {
                <audio-component [track]="remoteTrack.trackPublication.audioTrack!"></audio-component>
                } @else if (remoteTrack.trackPublication.kind === 'video') {
                <video-component
                    [track]="remoteTrack.trackPublication.videoTrack!"
                    [participantIdentity]="remoteTrack.participantIdentity"
                    [local]="false"
                >
                </video-component>
                } }
            </div>
        </div>

        <!-- Cột phải: Chat -->
        <aside id="chat-panel">
            <h4>Chat</h4>
            <div id="chat-messages">
                @for (msg of messages(); track $index) {
                <div class="chat-line">
                    <b>{{ msg.from }}:</b> {{ msg.text }}
                </div>
                }
            </div>

            <form (ngSubmit)="sendMessage()" id="chat-form">
                <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="chatInput"
                    name="chatInput"
                    placeholder="Type a message..."
                    required
                />
                <button type="submit" class="btn btn-primary mt-2">Send</button>
            </form>
        </aside>
    </div>
</div>
}
